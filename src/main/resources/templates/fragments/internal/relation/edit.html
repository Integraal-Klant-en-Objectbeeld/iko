<th:block th:fragment="relation-edit">
    <cds-form-group id="form-group" name="form-group" class="cds-theme-zone-white" data-carbon-theme="white">
        <cds-stack gap="7">
            <cds-form-item>
                <cds-dropdown name="sourceId"
                              size="lg"
                              style="width: 100%"
                              helper-text=""
                              title-text="From"
                              label="Select a from"
                              th:attr="
                                invalid=${errors?.getFieldError('sourceId') != null} ? 'true' : null,
                                invalid-text=${errors?.getFieldError('sourceId')?.defaultMessage},
                                value=${form?.sourceId}">
                    <cds-dropdown-item value="">
                         Root source
                    </cds-dropdown-item>
                    <cds-dropdown-item th:each="source : ${sources}"
                                       th:value="${source.id}">
                        <span th:text="'Relation (' +${source.name} +')'"></span>
                    </cds-dropdown-item>
                </cds-dropdown>
            </cds-form-item>
            <cds-form-item>
                <cds-select
                    label-text="Select an connector instance"
                    size="lg"
                    name="connectorInstanceId"
                    hx-get="/admin/aggregated-data-profiles/create/endpoints"
                    hx-trigger="cds-select-selected"
                    hx-target="#formRelationEndpoints"
                    th:value="${form?.connectorInstanceId}">

                    <cds-select-item th:each="instance: ${connectorInstances}"
                                     th:value="${instance.id}">
                        (<span th:text="${instance.connector.name}"></span>)
                        <span th:text="${instance.name}"></span>
                    </cds-select-item>
                </cds-select>
            </cds-form-item>

            <div id="formRelationEndpoints" th:fragment="connectorEndpoints">
                <cds-form-item>
                    <cds-select label-text="Select an connector endpoint"
                                size="lg"
                                name="connectorEndpointId"
                                th:value="${form?.connectorEndpointId}">
                        <cds-select-item th:each="endpoint: ${connectorEndpoints}"
                                         th:value="${endpoint.id}">
                            <span th:text="${endpoint.name}"></span>
                        </cds-select-item>
                    </cds-select>
                </cds-form-item>
            </div>

            <cds-form-item>
                <cds-textarea name="sourceToEndpointMapping"
                              label="Endpoint parameter Mapping"
                              placeholder="e.g. {'searchParamA': '.myField'}"
                              th:attr="invalid=${errors?.getFieldError('sourceToEndpointMapping') != null} ? 'true' : null,
                                invalid-text=${errors?.getFieldError('sourceToEndpointMapping')?.defaultMessage},
                                value=${form?.sourceToEndpointMapping}">
                </cds-textarea>
            </cds-form-item>
            <cds-form-item>
                <cds-text-input name="propertyName"
                                label="Property Name"
                                placeholder="e.g. relation"
                                th:attr="invalid=${errors?.getFieldError('propertyName') != null} ? 'true' : null,
                                invalid-text=${errors?.getFieldError('propertyName')?.defaultMessage},
                                value=${form?.propertyName}">
                </cds-text-input>
            </cds-form-item>
            <cds-form-item>
                <cds-textarea name="transform"
                              label="Transform"
                              helper-text="A valid JQ expression learn at https://jqlang.org/tutorial/"
                              placeholder="e.g. {'fieldA': '.fieldB'}"
                              th:attr="invalid=${errors?.getFieldError('transform') != null} ? 'true' : null,
                                invalid-text=${errors?.getFieldError('transform')?.defaultMessage},
                                value=${form?.transform}">
                </cds-textarea>
            </cds-form-item>
            <input type="hidden" name="aggregatedDataProfileId" th:value="${form.aggregatedDataProfileId}"/>
            <input type="hidden" name="id" th:value="${form.id}"/>
        </cds-stack>
    </cds-form-group>

    <div class="button-bar">
        <cds-button kind="danger"
                    th:attr="hx-get=@{'/admin/aggregated-data-profiles/' + ${form.aggregatedDataProfileId} + '/relations/edit/' + ${form.id} + '/delete'} "
                    hx-target="#modal-container"
                    hx-swap="innerHTML"
                    hx-on::after-request="document.querySelector('cds-modal')?.setAttribute('open', 'true');"
                    hx-push-url="false">
            Delete
        </cds-button>
        <cds-button
            kind="secondary"
            th:attr="
                        hx-get=@{'/admin/aggregated-data-profiles/' + ${form.aggregatedDataProfileId} + '/relations/create'},
                        hx-target='#selected-relation',
                        hx-swap='innerHTML',
                        hx-push-url='false'"
        >
            Add relation
        </cds-button>
        <cds-button
            hx-put="/admin/relations"
            hx-include="#form-group *"
            hx-swap="outerHTML">
            Save
        </cds-button>
    </div>

</th:block>
