<!DOCTYPE html>
<!--<html xmlns:th="http://www.thymeleaf.org" lang="en">-->
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      lang="en">
<head>
    <meta charset="UTF-8">
    <title>IKO Admin</title>

    <!-- Preconnects for faster resource loading -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://1.www.s81c.com">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@2.0.4"
            integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
            crossorigin="anonymous"></script>

    <meta charset="UTF-8"/>

    <!-- Carbon v11 CDN stylesheet -->
    <link rel="stylesheet" href="https://unpkg.com/@carbon/styles@1/css/styles.css">
    <link rel="stylesheet" href="https://1.www.s81c.com/common/carbon-for-ibm-dotcom/tag/v1/latest/plex.css"/>
    <link rel="stylesheet" href="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/grid.css"/>
    <link rel="stylesheet" href="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/themes.css"/>

    <!-- Dynamically load Carbon Web Components -->
    <script type="module">
        const components = [
            'accordion', 'breadcrumb', 'button', 'checkbox', 'code-snippet', 'combo-box',
            'content-switcher', 'copy-button', 'data-table', 'date-picker', 'dropdown',
            'file-uploader', 'floating-menu', 'form', 'form-group', 'inline-loading', 'input', 'link',
            'list', 'loading', 'modal', 'multi-select', 'notification', 'number-input',
            'overflow-menu', 'pagination', 'progress-indicator', 'radio-button', 'search',
            'select', 'skeleton-placeholder', 'skeleton-text', 'skip-to-content', 'slider', 'stack',
            'structured-list', 'tabs', 'tag', 'textarea', 'tile', 'toggle', 'tooltip', 'ui-shell',
        ];
        // Import each Carbon component module dynamically.
        for (const component of components) {
            import(`https://1.www.s81c.com/common/carbon/web-components/tag/latest/${component}.rtl.min.js`);
        }
    </script>
    <style>
        body {
            margin-left: 2rem;
            padding: 0;
            padding-top: 3rem;
        }
    </style>
</head>
<body class="cds-theme-zone-g10">
<header>
    <cds-header aria-label="IKO App">
        <cds-header-name href="/admin" prefix="IKO">
            [Integraal Klant & Objectbeeld]
        </cds-header-name>
        <!-- Left Panel (Navigation) -->
        <cds-side-nav th:insert="~{fragments/internal/menu :: menu}"></cds-side-nav>
    </cds-header>
</header>
<main class="cds--grid cds--grid--full-width">
    <div class="cds--row">
        <div class="cds--col-lg-14 cds--offset-lg-2">
            <div id="view-panel" layout:fragment="view-panel-content">
                <div class="cds--tile">
                    <cds-breadcrumb no-trailing-slash="">
                        <cds-breadcrumb-item>
                            <cds-breadcrumb-link
                                href="/admin"
                                is-currentpage="true">
                                Home
                            </cds-breadcrumb-link>
                        </cds-breadcrumb-item>
                    </cds-breadcrumb>
                    <h4>Welcome to IKO</h4>
                    <img
                        class="page-landing__illo"
                        th:src="@{tab-illo.png}"
                        alt="Carbon illustration"
                        width="640"
                        height="498"/>
                    <div id="rete-container" style="width: 800px; height: 600px;"></div>
                    <script type="module">
                        import { NodeEditor, ClassicPreset } from "https://esm.sh/rete";
                        import { AreaPlugin, AreaExtensions } from "https://esm.sh/rete-area-plugin";
                        import { ConnectionPlugin, Presets as ConnectionPresets } from "https://esm.sh/rete-connection-plugin";
                        import { LitPlugin, Presets as LitPresets } from "https://esm.sh/@retejs/lit-plugin";

                        async function createEditor(container) {
                            const socket = new ClassicPreset.Socket("socket");

                            const editor = new NodeEditor();
                            const area = new AreaPlugin(container);
                            const render = new LitPlugin(); // MUST come before connection
                            const connection = new ConnectionPlugin();

                            render.addPreset(LitPresets.classic.setup());
                            connection.addPreset(ConnectionPresets.classic.setup());

                            editor.use(area);
                            area.use(render);     // IMPORTANT: render must be initialized before connection
                            area.use(connection);

                            AreaExtensions.selectableNodes(area, AreaExtensions.selector(), {
                                accumulating: AreaExtensions.accumulateOnCtrl(),
                            });

                            AreaExtensions.simpleNodesOrder(area);

                            const a = new ClassicPreset.Node("A");
                            a.addControl("a", new ClassicPreset.InputControl("text", { initial: "a" }));
                            a.addOutput("a", new ClassicPreset.Output(socket));
                            await editor.addNode(a);

                            const b = new ClassicPreset.Node("B");
                            b.addControl("b", new ClassicPreset.InputControl("text", { initial: "b" }));
                            b.addInput("b", new ClassicPreset.Input(socket));
                            await editor.addNode(b);

                            await editor.addConnection(new ClassicPreset.Connection(a, "a", b, "b"));

                            await area.translate(a.id, { x: 0, y: 0 });
                            await area.translate(b.id, { x: 270, y: 0 });

                            setTimeout(() => {
                                AreaExtensions.zoomAt(area, editor.getNodes());
                            }, 10);
                        }

                        createEditor(document.getElementById("rete-container"));
                    </script>
                </div>
            </div>
        </div>
    </div>
</main>
<!--Modal container-->
<div id="modal-container"></div>
<script type="text/javascript">
    /*htmx.logAll();*/
    htmx.config.allowNestedOobSwaps = false; // Disable nested out-of-band swaps
</script>
</body>
</html>