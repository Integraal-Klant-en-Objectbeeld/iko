<div th:fragment="relations-panel">
    <div class="detail-grid">
        <!-- Left column -->
        <div class="detail-column">
            <cds-tile class="left-column">
                <span class="tile-header">Relations</span>
                <div class="no-content-container" th:if="${relations.isEmpty()}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 150 150" fill="none">
                        <g clip-path="url(#clip0_4554_12419)">
                            <path d="M75.0004 146.887L20.8691 115.631L75.0004 84.3936L129.113 115.631L75.0004 146.887Z" fill="url(#paint0_linear_4554_12419)"/>
                            <path d="M74.9996 128.156L20.8496 96.8999L20.8684 34.3687L74.9996 65.6062V128.156Z" fill="url(#paint1_linear_4554_12419)"/>
                            <path d="M129.15 96.9L75 128.156V65.6063L129.131 34.3688L129.15 96.9Z" fill="url(#paint2_linear_4554_12419)"/>
                            <path d="M75.0004 65.6061L20.8691 34.3686L75.0004 3.1123L129.132 34.3686L75.0004 65.6061Z" fill="url(#paint3_linear_4554_12419)"/>
                            <path d="M48.693 50.0062L102.449 18.9749L101.662 18.5249L47.8867 49.5749L48.693 50.0062Z" fill="#C6C6C6"/>
                            <path d="M75.0004 66.0748L20.8691 34.8186V34.3686L21.2629 34.1436L75.3941 65.3998L75.0004 65.6061V66.0748Z" fill="white"/>
                            <path d="M40.293 62.4936L24.918 53.6248L24.9367 42.9561L40.293 51.8436V62.4936Z" fill="white"/>
                        </g>
                        <defs>
                            <linearGradient id="paint0_linear_4554_12419" x1="34.4066" y1="139.069" x2="115.594" y2="92.1935" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#525252" stop-opacity="0.05"/>
                                <stop offset="1" stop-opacity="0.1"/>
                            </linearGradient>
                            <linearGradient id="paint1_linear_4554_12419" x1="28.4246" y1="81.2624" x2="75.5809" y2="81.2624" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#E0E0E0"/>
                                <stop offset="1" stop-color="#C6C6C6"/>
                            </linearGradient>
                            <linearGradient id="paint2_linear_4554_12419" x1="75" y1="81.2625" x2="129.15" y2="81.2625" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#A8A8A8"/>
                                <stop offset="1" stop-color="#C6C6C6"/>
                            </linearGradient>
                            <linearGradient id="paint3_linear_4554_12419" x1="34.4066" y1="57.8061" x2="115.594" y2="10.9311" gradientUnits="userSpaceOnUse">
                                <stop stop-color="#F4F4F4"/>
                                <stop offset="1" stop-color="#E0E0E0"/>
                            </linearGradient>
                            <clipPath id="clip0_4554_12419">
                                <rect width="150" height="150" fill="white"/>
                            </clipPath>
                        </defs>
                    </svg>
                    <span class="no-content-text">No relations have been added yet</span>
                </div>

                <div id="relations-tree" th:fragment="relations-tree">
                    <cds-tree-view size="">
                        <cds-tree-node label="Profile root" class="pointer"
                                        hx-on:mousedown="document.querySelector('#selectedSourceId').value = ''">
                            <svg focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" fill="currentColor" slot="icon" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                                <rect width="16" height="16" fill="white" style="mix-blend-mode:multiply"/>
                                <path d="M14 6C14.2652 6 14.5196 5.89464 14.7071 5.70711C14.8946 5.51957 15 5.26522 15 5V2C15 1.73478 14.8946 1.48043 14.7071 1.29289C14.5196 1.10536 14.2652 1 14 1H2C1.73478 1 1.48043 1.10536 1.29289 1.29289C1.10536 1.48043 1 1.73478 1 2V5C1 5.26522 1.10536 5.51957 1.29289 5.70711C1.48043 5.89464 1.73478 6 2 6H7.5V8H4.5C4.23478 8 3.98043 8.10536 3.79289 8.29289C3.60536 8.48043 3.5 8.73478 3.5 9V11H2C1.73478 11 1.48043 11.1054 1.29289 11.2929C1.10536 11.4804 1 11.7348 1 12V14C1 14.2652 1.10536 14.5196 1.29289 14.7071C1.48043 14.8946 1.73478 15 2 15H6C6.26522 15 6.51957 14.8946 6.70711 14.7071C6.89464 14.5196 7 14.2652 7 14V12C7 11.7348 6.89464 11.4804 6.70711 11.2929C6.51957 11.1054 6.26522 11 6 11H4.5V9H11.5V11H10C9.73478 11 9.48043 11.1054 9.29289 11.2929C9.10536 11.4804 9 11.7348 9 12V14C9 14.2652 9.10536 14.5196 9.29289 14.7071C9.48043 14.8946 9.73478 15 10 15H14C14.2652 15 14.5196 14.8946 14.7071 14.7071C14.8946 14.5196 15 14.2652 15 14V12C15 11.7348 14.8946 11.4804 14.7071 11.2929C14.5196 11.1054 14.2652 11 14 11H12.5V9C12.5 8.73478 12.3946 8.48043 12.2071 8.29289C12.0196 8.10536 11.7652 8 11.5 8H8.5V6H14ZM6 14H2V12H6V14ZM14 14H10V12H14V14ZM2 2H14V5H2V2Z" fill="#525252"/>
                            </svg>
                            <cds-tree-node
                                th:each="parent : ${relations}"
                                th:if="${parent.sourceId == 'Profile root'}"
                                th:label="|${parent.propertyName} - ${parent.id}|"
                                hx-on:mousedown="document.querySelector('#selectedSourceId').value = this.getAttribute('data-source-id')"                                th:attr="hx-get=@{'/admin/aggregated-data-profiles/' + ${aggregatedDataProfile.id} + '/relations/edit/' + ${parent.id}},
                                         hx-trigger='mousedown consume',
                                         hx-target='#selected-relation',
                                         hx-swap='innerHTML',
                                         hx-push-url='false',
                                         data-source-id=${parent.id}"
                                class="pointer">
                                <th:block th:insert="~{::treeNode(parent=${parent})}"></th:block>
                            </cds-tree-node>
                        </cds-tree-node>
                    </cds-tree-view>
                </div>

                <th:block th:fragment="treeNode(parent)">
                    <cds-tree-node
                        th:each="child : ${relations}"
                        th:if="${parent != null and child.sourceId == parent.id.toString()}"
                        th:label="|${child.propertyName} - ${child.id}|"
                        hx-on:mousedown="document.querySelector('#selectedSourceId').value = this.getAttribute('data-source-id')"
                        th:attr="hx-get=@{'/admin/aggregated-data-profiles/' + ${aggregatedDataProfile.id} + '/relations/edit/' + ${child.id}},
                                 hx-trigger='mousedown consume',
                                 hx-target='#selected-relation',
                                 hx-swap='innerHTML',
                                 hx-push-url='false',
                                 data-source-id=${child.id}"

                        class="pointer">

                        <th:block th:insert="~{::treeNode(parent=${child})}"></th:block>

                    </cds-tree-node>
                </th:block>


                <cds-button kind="secondary"
                            th:attr="
                                    hx-get=@{'/admin/aggregated-data-profiles/' + ${aggregatedDataProfile.id} + '/relations/create'},
                                    hx-vals=|js:{ sourceId: document.querySelector('#selectedSourceId').value }|,
                                    hx-target='#selected-relation',
                                    hx-swap='innerHTML',
                                    hx-push-url='false'"
                            size="xl">
                    Add relation
                    <svg slot="icon" focusable="false" preserveAspectRatio="xMidYMid meet" fill="currentColor" width="16" height="16" viewBox="0 0 32 32" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"><path d="M17 15L17 8 15 8 15 15 8 15 8 17 15 17 15 24 17 24 17 17 24 17 24 15z"></path><title>Add</title></svg>
                </cds-button>
                <input type="hidden" id="selectedSourceId" value="" />
            </cds-tile>
        </div>
        <!-- Right column -->
        <div class="detail-column">
            <cds-tile class="right-tile" >
                <span id="selected-relation-name"></span>
                <div id="selected-relation"></div>
            </cds-tile>
        </div>
    </div>
</div>